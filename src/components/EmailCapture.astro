<form id="subscribe-form" class="flex items-center">
    <input type="email" name="email" id="email-input" placeholder="your@email.com" required class="input-field rounded-r-none flex-grow" />
    <button type="submit" class="btn px-6 py-3 rounded-l-none text-base">Subscribe</button>
</form>
<p id="subscribe-status" class="mt-2 text-sm h-5"></p>

<script>
    import { supabase } from '../lib/supabase';

    const form = document.getElementById('subscribe-form');
    const statusEl = document.getElementById('subscribe-status');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        statusEl.textContent = 'Subscribing...';
        statusEl.className = 'mt-2 text-sm h-5 text-gray-500';

        const formData = new FormData(form as HTMLFormElement);
        const email = formData.get('email') as string;

        const { error } = await supabase.from('emails').insert({ email });

        if (error) {
            statusEl.textContent = 'Error: Already subscribed or invalid email.';
            statusEl.className = 'mt-2 text-sm h-5 text-red-500';
        } else {
            statusEl.textContent = 'Success! Thanks for subscribing.';
            statusEl.className = 'mt-2 text-sm h-5 text-green-500';
            (form as HTMLFormElement).reset();
        }

        setTimeout(() => {
            if (statusEl) statusEl.textContent = '';
        }, 5000);
    });
</script>